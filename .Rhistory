round(sd_apx(min = min(elm$HT), max = max(elm$HT)),1),
round(sd_apx(min = min(elm$CROWN_DIAM_WIDE), max = max(elm$CROWN_DIAM_WIDE)),1),
round(sd_apx(min = min(carbon_state/100), max = max(carbon_state/100)),1),
round(sd_apx(min = min(iris$Petal.Length), max = max(iris$Petal.Length)),1),
round(sd_apx(min = min(iris$Sepal.Width), max = max(iris$Sepal.Width)),1),
round(sd_apx(min = min(CO2$conc/100), max = max(CO2$conc/100)),1),
round(sd_apx(min = min(CO2$uptake), max = max(CO2$uptake)),1))
# Chunk 1
library(tidyverse)
library(googlesheets4)
library(knitr)
library(formattable)
library(kableExtra)
options(kableExtra.auto_format = FALSE)
# Chunk 2
# Here is the function:
total_AGB<-function(SPGRP_JENKINS,DIA){
if(SPGRP_JENKINS=='Aspen')
{JENKINS_TOTAL_B1=-2.2094; JENKINS_TOTAL_B2=2.3867}
if(SPGRP_JENKINS=='Cedar/larch')
{JENKINS_TOTAL_B1=-2.0336; JENKINS_TOTAL_B2=2.2592}
if(SPGRP_JENKINS=='Maple/oak/hickory/beech')
{JENKINS_TOTAL_B1=-2.0127; JENKINS_TOTAL_B2=2.4342}
if(SPGRP_JENKINS=='Mixed hardwood')
{JENKINS_TOTAL_B1=-2.48; JENKINS_TOTAL_B2=2.4835}
if(SPGRP_JENKINS=='Pine')
{JENKINS_TOTAL_B1=-2.5356; JENKINS_TOTAL_B2=2.4349}
if(SPGRP_JENKINS=='Soft maple/birch')
{JENKINS_TOTAL_B1=-1.9123; JENKINS_TOTAL_B2=2.3651}
if(SPGRP_JENKINS=='Spruce')
{JENKINS_TOTAL_B1=-2.0773; JENKINS_TOTAL_B2=2.3323}
if(SPGRP_JENKINS=='True fir/hemlock')
{JENKINS_TOTAL_B1=-2.5384; JENKINS_TOTAL_B2=2.4814}
# Calculate total aboveground biomass of each tree (AGB)
# Note the equation predicts biomass in kg, but we  convert it into pounds
AGB=(exp(JENKINS_TOTAL_B1+JENKINS_TOTAL_B2*log(DIA*2.54)))*2.20462
return(AGB=AGB)}
# Chunk 3
#Read in datasets
# tree carbon
tree <- read_sheet("https://docs.google.com/spreadsheets/d/1sjRe8pi08C4jY8TlDBeRKxmhqMlo85eB5wmqNovsiOU/edit?usp=sharing")
# wood carbon
wood2021 <- read_sheet("https://docs.google.com/spreadsheets/d/1ekdnxAnmO0PfVAmA-aZ1j6lNdwNKMGz7WLK1vBttmtA/edit?usp=sharing")
PLOT_SIZE = 10
wood2021$AGB1<-mapply(total_AGB, SPGRP_JENKINS=wood2021$Spp2, DIA=wood2021$DBH1)
wood2021$C1<-wood2021$AGB1*0.5
wood2021$C_sum1<-wood2021$C1*PLOT_SIZE
wood2021$AGB2<-mapply(total_AGB, SPGRP_JENKINS=wood2021$Spp2, DIA=wood2021$DBH2)
wood2021$C2<-wood2021$AGB2*0.5
wood2021$C_sum2<-wood2021$C2*PLOT_SIZE
plot.C <- wood2021 %>%
group_by(Team) %>%
summarize(CPA1 = sum(C_sum1),
CPA2 = sum(C_sum2))
plot.C$CO2e1 <- plot.C$CPA1 * 3.667
plot.C$tons1 <- plot.C$CPA1 / 2000
# elm
elm <- read_csv('C:/Users/russellm/Documents/Projects/SNRAwR/SNRAwR/Data/elm.csv')
# State Carbon (MMT) in 2019
carbon_state <- c(1238,
1288,
1407,
1041,
1157,
233,
1437,
1470,
888,
1041,
835,
165,
346,
1102,
368,
176,
191,
1596,
325,
215,
1911,
3186,
473,
1162,
992,
3044,
873,
481,
610,
657,
1533,
1215,
2706,
1726,
38,
1429,
91,
35,
277,
48,
1707,
522,
110,
705,
622,
1867,
1224,
458)
# iris
# iris$Petal.Length
# iris$Sepal.Width
# Chunk 4
sd_apx <- function(min, max){
sd_hat = (max-min)/4
return(sd_hat)
}
# Chunk 5
Dataset <- c("carbon",
"carbon",
"elm",
"elm",
"elm",
"state_carbon",
"iris",
"iris",
"CO2",
"CO2")
Variable <- c("DBH",
"Tons",
"DIA",
"HT",
"CROWN_DIAM_WIDE",
"MMT/100",
"Petal.Length",
"Sepal.Width",
"conc/100",
"uptake")
SD_true <- c(round(sd(tree$DBH1),1),
round(sd(plot.C$tons1),1),
round(sd(elm$DIA),1),
round(sd(elm$HT),1),
round(sd(elm$CROWN_DIAM_WIDE),1),
round(sd(carbon_state/100),1),
round(sd(iris$Petal.Length),1),
round(sd(iris$Sepal.Width),1),
round(sd(CO2$conc/100),1),
round(sd(CO2$uptake),1))
SD_apxx <- c(round(sd_apx(min = min(tree$DBH1), max = max(tree$DBH1)),1),
round(sd_apx(min = min(plot.C$tons1), max = max(plot.C$tons1)),1),
round(sd_apx(min = min(elm$DIA), max = max(elm$DIA)),1),
round(sd_apx(min = min(elm$HT), max = max(elm$HT)),1),
round(sd_apx(min = min(elm$CROWN_DIAM_WIDE), max = max(elm$CROWN_DIAM_WIDE)),1),
round(sd_apx(min = min(carbon_state/100), max = max(carbon_state/100)),1),
round(sd_apx(min = min(iris$Petal.Length), max = max(iris$Petal.Length)),1),
round(sd_apx(min = min(iris$Sepal.Width), max = max(iris$Sepal.Width)),1),
round(sd_apx(min = min(CO2$conc/100), max = max(CO2$conc/100)),1),
round(sd_apx(min = min(CO2$uptake), max = max(CO2$uptake)),1))
all_data <- tibble(Dataset, Variable, SD_true, SD_apxx)
all_data <- all_data %>%
mutate(`Percent different` = ((sd_true-sd_apxx)/sd_true)*100)
# Chunk 6
knitr::kable((all_data[,1:4]),
caption = 'Example datasets') %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE)
p.all <- ggplot(all_data, aes(x = sd_true, y = sd_apxx)) +
geom_point() +
geom_abline(slope=1, intercept = 0) +
xlab("True SD") +
ylab("Approximate SD") +
theme(panel.background = element_rect(fill = "NA"),
axis.line = element_line(color="black"),
axis.text = element_text(color = "black"))
p.all
View(all_data)
elm$DIA
min(elm$DIA)
max(elm$DIA)
elm
View(elm)
blogdown:::serve_site()
blogdown:::new_post_addin()
library(tidyverse)
library(gsheet)
library(GGally)
library(rgdal)
library(usmap)
library(ggrepel)
library(knitr)
library(kableExtra)
library(patchwork)
library(gsheet)
library(GGally)
library(rgdal)
library(usmap)
stateC<-read_csv("C:\\Users\\russellm\\Documents\\Arbor\\Data\\statecarbon.csv")
p.us <- plot_usmap(data = stateC, values = "Total_2019", lines = "black",
include = c("AL","AZ","AR","CA","CO","CT","DE","FL","GA","ID","IL",
"IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS",
"MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH",
"OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA",
"WA","WV","WI","WY"))+
scale_fill_continuous(low = "white", high = "red", name = "Million\nmetric\ntonnes", label = scales::comma) +
labs(title = "Carbon storage in US forests (MMT)",
subtitle = "Above and belowground carbon, dead wood, litter, and soil (mineral + organic)") +
theme(legend.position = "right")
ggsave(filename =  "C:\\Users\\russellm\\Documents\\Arbor\\Projects\\CheatSheet\\uscarbon21.png",
plot=p.us,width=5,height=4,units="in",scale=1, dpi=1000)
pool <-
tribble(
~Pool, ~Value,
"Aboveground\nbiomass",	15260,
"Belowgrown\nbiomass",	3103,
"Dead wood",	2852,
"Litter",	3638,
"Soil (organic)",	5933,
"Soil (mineral)", 25147
)
p.pool <- ggplot(pool, aes(reorder(Pool, Value),Value, fill=Value)) +
geom_bar(stat="identity") +
coord_flip() +
scale_y_continuous(limits = c(0,26000)) +
labs(x = " ", y = "US carbon stock (MMT)", title = "Carbon pools in US forests (2019)")+
theme(panel.background = element_rect(fill = "NA"),
axis.line = element_line(color="black"),
legend.position = "none")
p.pool
ggsave(filename =  "C:\\Users\\russellm\\Documents\\Arbor\\Projects\\CheatSheet\\carbonpool21.png",
plot=p.pool,width=4,height=2,units="in",scale=1, dpi=1000)
55933000000/279386
55993000000/279386
55993000/279386
200.41/2.2417
2669/58632
blogdown:::serve_site()
blogdown:::new_post_addin()
library(tidyFIA)
library(tidyverse)
library(sf)
library(spData)
library(knitr)
library(kableExtra)
library(tidycensus)
library(urbnmapr)
me_data <- tidy_fia(
states = "ME",
table_names = c("plot", "tree", "cond"),
postgis = FALSE
)
plot <- me_data[["plot"]] %>% filter(invyr >= 1999)
cond <- me_data[["cond"]] %>% filter(invyr >= 1999)
tree <- me_data[["tree"]] %>% filter(invyr >= 1999)
ref_species <- read_ref_table("REF_SPECIES") %>%
select(spcd, common_name)
common_spp <- me_data[["tree"]] %>%
group_by(spcd) %>%
tally %>%
top_n(6, wt = n) %>%
pull(spcd)
common_spp
tree <- tree %>%
# filter(spcd %in% common_spp) %>%
left_join(ref_species) %>%
ggplot(aes(x = dia, y = carbon_ag)) +
geom_point(alpha = 0.2) +
facet_wrap(~ common_name) +
labs (x = "Tree diameter (inches)",
y = "Aboveground carbon (pounds)")
plot <- me_data[["plot"]] %>% filter(invyr >= 1999)
cond <- me_data[["cond"]] %>% filter(invyr >= 1999)
tree <- me_data[["tree"]] %>% filter(invyr >= 1999)
tree <- tree %>%
# filter(spcd %in% common_spp) %>%
left_join(ref_species)#
tree$carbon_ag
tree$drybio_ag
View(ref_species)
tree <- tree %>%
mutate(carbon_ag_new = ifelse(spcd < 300, drybio_ag * 0.501,  drybio_ag * 0.465))
tree <- tree %>%
mutate(carbon_ag_new = ifelse(spcd < 300, drybio_ag * 0.501,  drybio_ag * 0.465),
sp_type = ifelse(spcd < 300, "Conifers",  "Hardwoods"))
ggplot(aes(x = carbon_ag, y = carbon_ag_new)) +
geom_point(alpha = 0.2) +
facet_wrap(~ sp_type) +
labs (x = "Aboveground carbon (pounds; assume mass = 50% carbon)",
y = "Aboveground carbon (pounds; assume mass = varying carbon)")
ggplot(tree, aes(x = carbon_ag, y = carbon_ag_new)) +
geom_point(alpha = 0.2) +
facet_wrap(~ sp_type) +
labs (x = "Aboveground carbon (pounds; assume mass = 50% carbon)",
y = "Aboveground carbon (pounds; assume mass = varying carbon)")
p.carb <- ggplot(tree, aes(x = carbon_ag, y = carbon_ag_new)) +
geom_point(alpha = 0.2) +
facet_wrap(~ sp_type) +
geom_abline(intercept = 0, slope = 1) +
labs (x = "Aboveground carbon (pounds; assume mass = 50% carbon)",
y = "Aboveground carbon (pounds; assume mass = varying carbon)")
p.carb
plot_stats <- tree %>%
group_by(plt_cn) %>%
filter(statuscd == 1) %>%
summarize(
bapa = sum(tpa_unadj * 0.005454 * dia ^ 2, na.rm = TRUE),
cpa_0.5 =  sum(tpa_unadj * carbon_ag, na.rm = TRUE),
cpa_new =  sum(tpa_unadj * carbon_ag_new, na.rm = TRUE)
) %>%
full_join(
plot %>% select(cn, statecd, unitcd, countycd, plot, invyr),
by = c("plt_cn" = "cn")
) %>%
mutate(cpa_0.5_tons = cpa_0.5 /2000,
cpa_0.5_new_tons = cpa_0.5_new /2000) %>%
replace_na(replace = list(bapa = 0, cpa = 0))
plot_stats <- tree %>%
group_by(plt_cn) %>%
filter(statuscd == 1) %>%
summarize(
bapa = sum(tpa_unadj * 0.005454 * dia ^ 2, na.rm = TRUE),
cpa_0.5 =  sum(tpa_unadj * carbon_ag, na.rm = TRUE),
cpa_new =  sum(tpa_unadj * carbon_ag_new, na.rm = TRUE)
) %>%
full_join(
plot %>% select(cn, statecd, unitcd, countycd, plot, invyr),
by = c("plt_cn" = "cn")
) %>%
mutate(cpa_0.5_tons = cpa_0.5 /2000,
cpa_new_tons = cpa_0.5_new /2000) %>%
replace_na(replace = list(bapa = 0, cpa_0.5_tons = 0, cpa_new_tons = 0))
plot_stats <- tree %>%
group_by(plt_cn) %>%
filter(statuscd == 1) %>%
summarize(
bapa = sum(tpa_unadj * 0.005454 * dia ^ 2, na.rm = TRUE),
cpa_0.5 =  sum(tpa_unadj * carbon_ag, na.rm = TRUE),
cpa_new =  sum(tpa_unadj * carbon_ag_new, na.rm = TRUE)
) %>%
full_join(
plot %>% select(cn, statecd, unitcd, countycd, plot, invyr),
by = c("plt_cn" = "cn")
) %>%
mutate(cpa_0.5_tons = cpa_0.5 /2000,
cpa_new_tons = cpa_new /2000) %>%
replace_na(replace = list(bapa = 0, cpa_0.5_tons = 0, cpa_new_tons = 0))
p.plot <- ggplot(plot_stats, aes(x = cpa_0.5_tons, y = cpa_new_tons)) +
geom_point() +
stat_smooth() +
geom_abline(intercept = 0, slope = 1) +
labs (x = "Aboveground tree carbon (pounds; \nassume mass = 50% carbon)",
y = "Aboveground tree carbon (pounds; \nassume mass = varying carbon)")
p.plot
plot_stats_c<- plot_stats %>%
ungroup() %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_0.5_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_0.5_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_0.5_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_0.5_tons, na.rm = T), 1))
plot_stats_c
plot_stats
plot_stats_c<- plot_stats %>%
ungroup() %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_0.5_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_0.5_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_0.5_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_0.5_tons, na.rm = T), 1))
plot_stats_c
plot_stats_c_new <- plot_stats %>%
ungroup() %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_new_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_new_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_new_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_new_tons, na.rm = T), 1))
plot_stats_c_new
plot_stats_big <- plot_stats %>%
filter(cpa_0.5_tons >= 50)
plot_stats_c<- plot_stats_big %>%
ungroup() %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_0.5_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_0.5_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_0.5_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_0.5_tons, na.rm = T), 1))
plot_stats_c
plot_stats_c_new <- plot_stats_big %>%
ungroup() %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_new_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_new_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_new_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_new_tons, na.rm = T), 1))
plot_stats_c_new
p.me <- plot(me_data)
p.me
p.me <- plot(me_data) + labs(title = "FIA plots in Maine")
p.me
p.me <- plot(me_data) + geom_point(alpha = 0.01) + labs(title = "FIA plots in Maine, USA")
p.me
p.plot <- ggplot(plot_stats, aes(x = cpa_0.5_tons, y = cpa_new_tons)) +
geom_point() +
stat_smooth() +
geom_abline(intercept = 0, slope = 1) +
labs (x = "Aboveground tree carbon (US tons per acre; \nassume mass = 50% carbon)",
y = "Aboveground tree carbon (US tons per acre; \nassume mass = varying carbon)") +
theme(panel.background = element_blank(),
axis.line = element_line(color = "black"),
axis.text = element_text(color = "black"))
p.plot
plot_stats_c<- plot_stats %>%
ungroup() %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_0.5_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_0.5_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_0.5_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_0.5_tons, na.rm = T), 1))
plot_stats_c
plot_stats_c_new <- plot_stats %>%
ungroup() %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_new_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_new_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_new_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_new_tons, na.rm = T), 1))
plot_stats_c_new
(16.2-15.6)/16.2
plot_stats_big <- plot_stats %>%
filter(cpa_0.5_tons >= 50)
plot_stats_c<- plot_stats_big %>%
ungroup() %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_0.5_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_0.5_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_0.5_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_0.5_tons, na.rm = T), 1))
plot_stats_c
plot_stats_c_new <- plot_stats_big %>%
ungroup() %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_new_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_new_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_new_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_new_tons, na.rm = T), 1))
plot_stats_c_new
(55-52.2)/55
names(plot)
plot_stats_for <- tree %>%
group_by(plt_cn) %>%
filter(statuscd == 1) %>%
summarize(
bapa = sum(tpa_unadj * 0.005454 * dia ^ 2, na.rm = TRUE),
cpa_0.5 =  sum(tpa_unadj * carbon_ag, na.rm = TRUE),
cpa_new =  sum(tpa_unadj * carbon_ag_new, na.rm = TRUE)
) %>%
full_join(
plot %>% select(cn, statecd, unitcd, countycd, plot, invyr, ecosubcd),
by = c("plt_cn" = "cn")
) %>%
mutate(cpa_0.5_tons = cpa_0.5 /2000,
cpa_new_tons = cpa_new /2000) %>%
replace_na(replace = list(bapa = 0, cpa_0.5_tons = 0, cpa_new_tons = 0))
common_eco <- plot_stats2 %>%
group_by(ecosubcd) %>%
tally %>%
top_n(6, wt = n) %>%
pull(ecosubcd)
common_eco <- plot_stats_for %>%
group_by(ecosubcd) %>%
tally %>%
top_n(6, wt = n) %>%
pull(ecosubcd)
common_eco
plot_stats_for %>%
filter(ecosubcd %in% common_eco) %>%
left_join(ref_species) %>%
ggplot(aes(x = cpa_0.5_tons, y = cpa_new_tons)) +
geom_point() +
stat_smooth() +
facet_wrap(~ecosubcd) +
geom_abline(intercept = 0, slope = 1) +
labs (x = "Aboveground tree carbon (US tons per acre; \nassume mass = 50% carbon)",
y = "Aboveground tree carbon (US tons per acre; \nassume mass = varying carbon)") +
theme(panel.background = element_blank(),
axis.line = element_line(color = "black"),
axis.text = element_text(color = "black"))
ref_eco<- tribble(
~ecosubcd, ~econame,
"211Aa", "Aroostook Hills Subsection",
"211Bb", "Maine-New Brunswick Lowlands Subsection",
"211Da", "Central Maine Embayment Subsection",
"M211Ab", "St. John Upland Subsection",
"M211Ac", "Maine Central Mountains Subsection",
"M211Af", "Connecticut Lakes Subsection"
)
plot_stats_for %>%
filter(ecosubcd %in% common_eco) %>%
left_join(ref_eco) %>%
ggplot(aes(x = cpa_0.5_tons, y = cpa_new_tons)) +
geom_point() +
stat_smooth() +
facet_wrap(~ecosubcd) +
geom_abline(intercept = 0, slope = 1) +
labs (x = "Aboveground tree carbon (US tons per acre; \nassume mass = 50% carbon)",
y = "Aboveground tree carbon (US tons per acre; \nassume mass = varying carbon)") +
theme(panel.background = element_blank(),
axis.line = element_line(color = "black"),
axis.text = element_text(color = "black"))
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::new_post_addin()
blogdown:::serve_site()
