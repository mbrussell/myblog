tree <- me_data[["tree"]] %>% filter(invyr >= 1999)
plot <- me_data[["PLOT"]] %>% filter(invyr >= 1999)
plot <- me_data[["plot"]] %>% filter(invyr >= 1999)
# Chunk 2
library(tidyFIA)
# Chunk 3
library(sf)
library(spData)
library(knitr)
library(kableExtra)
library(tidycensus)
library(urbnmapr)
# Chunk 4
me_data <- tidy_fia(
states = "ME",
table_names = c("plot", "tree", "cond"),
postgis = FALSE
)
# Chunk 5
p.me <- plot(me_data)
p.me
# Chunk 6
plot <- me_data[["plot"]] %>% filter(invyr >= 1999)
cond <- me_data[["cond"]] %>% filter(invyr >= 1999)
tree <- me_data[["tree"]] %>% filter(invyr >= 1999)
plot <- me_data[["plot"]]
cond <- me_data[["cond"]]
tree <- me_data[["tree"]]
View(plot)
plot <- plot %>%
filter(invyr >= 1999)
is.numeric(plot$invyr)
plot2 <- plot %>%
filter(invyr >= 1999)
plot2 <- tibble(plot)
?tibble
plot2 <- as.tibble(plot)
library(tidyverse)
plot <- me_data[["plot"]] %>% filter(invyr >= 1999)
cond <- me_data[["cond"]] %>% filter(invyr >= 1999)
tree <- me_data[["tree"]] %>% filter(invyr >= 1999)
plot_stats <- tree %>%
group_by(plt_cn) %>%
filter(statuscd == 1) %>%
summarize(
bapa = sum(tpa_unadj * 0.005454 * dia ^ 2, na.rm = TRUE),
cpa =  sum(tpa_unadj * carbon_ag, na.rm = TRUE)
) %>%
full_join(
plot %>% select(cn, statecd, unitcd, countycd, plot, invyr),
by = c("plt_cn" = "cn")
) %>%
mutate(cpa_tons = cpa /2000) %>%
replace_na(replace = list(bapa = 0, cpa = 0))
p.carbon <- ggplot(plot_stats, aes(x = bapa, y = cpa_tons)) +
geom_point() +
labs (x = "Basal area (sq. ft per acre)",
y = "Aboveground carbon (tons per acre)")
p.carbon
ref_species <- read_ref_table("REF_SPECIES") %>%
select(spcd, common_name)
common_spp <- me_data[["tree"]] %>%
group_by(spcd) %>%
tally %>%
top_n(6, wt = n) %>%
pull(spcd)
me_data[["tree"]] %>%
filter(spcd %in% common_spp) %>%
left_join(ref_species) %>%
ggplot(aes(x = dia, y = carbon_ag)) +
geom_point(alpha = 0.2) +
facet_wrap(~ common_name) +
labs (x = "Tree diameter (inches)",
y = "Aboveground carbon (pounds)")
plot2 <- plot_stats %>%
group_by(statecd, countycd, plot) %>%
mutate(plot_dummy = 1,
rem_id = cumsum(plot_dummy))
plot3 <- plot2 %>%
group_by(statecd, countycd, plot) %>%
summarize(max_rem_id = max(rem_id))
plot4 <- inner_join(plot3, plot2) %>%
filter(rem_id == max_rem_id)
plot_stats_c<- plot4 %>%
ungroup() %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_tons, na.rm = T), 1))
kable((plot_stats_c[,])) %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE)
fips <- fips_codes %>%
rename(countycd = county_code) %>%
mutate(countycd = as.numeric(countycd)) %>%
filter(state == "ME")
plot4 <- inner_join(plot4, fips)
plot_stats_c_county<- plot4 %>%
group_by(county) %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_tons, na.rm = T), 1))
kable((plot_stats_c_county[,])) %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE)
plot_stats_c_county<- plot4 %>%
group_by(statecd, countycd) %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_tons, na.rm = T), 1))
plot_stats_c_county <- plot_stats_c_county %>%
mutate(county_fips = paste(statecd, ifelse(countycd < 10, paste0("00", countycd),
paste0("0", countycd)), sep = ""))
carbon_data <- left_join(plot_stats_c_county, counties, by = "county_fips")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Mean carbon`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Mean carbon (tons per acre)")
plot_stats_c_county<- plot4 %>%
group_by(statecd, countycd) %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_tons, na.rm = T), 1))
plot_stats_c_county <- plot_stats_c_county %>%
mutate(county_fips = paste(statecd, ifelse(countycd < 10, paste0("00", countycd),
paste0("0", countycd)), sep = ""))
carbon_data <- left_join(plot_stats_c_county, counties, by = "county_fips")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Mean carbon`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Mean carbon \n(tons per acre)")
plot_stats_c_county<- plot4 %>%
group_by(statecd, countycd) %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_tons, na.rm = T), 1))
plot_stats_c_county <- plot_stats_c_county %>%
mutate(county_fips = paste(statecd, ifelse(countycd < 10, paste0("00", countycd),
paste0("0", countycd)), sep = ""))
carbon_data <- left_join(plot_stats_c_county, counties, by = "county_fips")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Mean carbon`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Mean carbon \n(tons per acre)")
blogdown:::serve_site()
blogdown:::serve_site()
library(tidyverse)
library(sf)
library(spData)
library(tidycensus)
library(urbnmapr)
carbon <- read.csv("C://Users//russellm//Documents//Projects//MFRC//Carbon//carboncounty.csv")
carbon <- read_csv("C://Users//russellm//Documents//Projects//MFRC//Carbon//carboncounty.csv")
carbon %>%
ggplot(aes(long, lat, group = group, fill = `Total`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Mean carbon \n(tons per acre)")
# Chunk 2
library(tidyFIA)
# Chunk 3
library(tidyverse)
library(sf)
library(spData)
library(knitr)
library(kableExtra)
library(tidycensus)
library(urbnmapr)
# Chunk 4
me_data <- tidy_fia(
states = "RI",
table_names = c("plot", "tree", "cond"),
postgis = FALSE
)
# Chunk 5
p.me <- plot(me_data)
p.me
# Chunk 6
plot <- me_data[["plot"]] %>% filter(invyr >= 1999)
cond <- me_data[["cond"]] %>% filter(invyr >= 1999)
tree <- me_data[["tree"]] %>% filter(invyr >= 1999)
# Chunk 7
plot_stats <- tree %>%
group_by(plt_cn) %>%
filter(statuscd == 1) %>%
summarize(
bapa = sum(tpa_unadj * 0.005454 * dia ^ 2, na.rm = TRUE),
cpa =  sum(tpa_unadj * carbon_ag, na.rm = TRUE)
) %>%
full_join(
plot %>% select(cn, statecd, unitcd, countycd, plot, invyr),
by = c("plt_cn" = "cn")
) %>%
mutate(cpa_tons = cpa /2000) %>%
replace_na(replace = list(bapa = 0, cpa = 0))
# Chunk 8
p.carbon <- ggplot(plot_stats, aes(x = bapa, y = cpa_tons)) +
geom_point() +
labs (x = "Basal area (sq. ft per acre)",
y = "Aboveground carbon (tons per acre)")
p.carbon
# Chunk 9
ref_species <- read_ref_table("REF_SPECIES") %>%
select(spcd, common_name)
common_spp <- me_data[["tree"]] %>%
group_by(spcd) %>%
tally %>%
top_n(6, wt = n) %>%
pull(spcd)
me_data[["tree"]] %>%
filter(spcd %in% common_spp) %>%
left_join(ref_species) %>%
ggplot(aes(x = dia, y = carbon_ag)) +
geom_point(alpha = 0.2) +
facet_wrap(~ common_name) +
labs (x = "Tree diameter (inches)",
y = "Aboveground carbon (pounds)")
# Chunk 10
plot2 <- plot_stats %>%
group_by(statecd, countycd, plot) %>%
mutate(plot_dummy = 1,
rem_id = cumsum(plot_dummy))
plot3 <- plot2 %>%
group_by(statecd, countycd, plot) %>%
summarize(max_rem_id = max(rem_id))
plot4 <- inner_join(plot3, plot2) %>%
filter(rem_id == max_rem_id)
# Chunk 11
plot_stats_c<- plot4 %>%
ungroup() %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_tons, na.rm = T), 1))
# Chunk 12
kable((plot_stats_c[,])) %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE)
# Chunk 13
fips <- fips_codes %>%
rename(countycd = county_code) %>%
mutate(countycd = as.numeric(countycd)) %>%
filter(state == "ME")
plot4 <- inner_join(plot4, fips)
plot_stats_c_county<- plot4 %>%
group_by(county) %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_tons, na.rm = T), 1))
# Chunk 14
kable((plot_stats_c_county[,])) %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE)
plot_stats_c_county<- plot4 %>%
group_by(statecd, countycd) %>%
summarize(`FIA plots` = n(),
`Mean carbon` = round(mean(cpa_tons, na.rm = T), 1),
`SD carbon` = round(sd(cpa_tons, na.rm = T), 1),
`Min carbon` = round(min(cpa_tons, na.rm = T), 1),
`Max carbon` = round(max(cpa_tons, na.rm = T), 1))
plot_stats_c_county <- plot_stats_c_county %>%
mutate(county_fips = paste(statecd, ifelse(countycd < 10, paste0("00", countycd),
paste0("0", countycd)), sep = ""))
carbon_data <- left_join(plot_stats_c_county, counties, by = "county_fips")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Mean carbon`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Mean carbon \n(tons per acre)")
carbon_data
carbon_data <- left_join(carbon, counties, by = "county_fips")
carbon <- read_csv("C://Users//russellm//Documents//Projects//MFRC//Carbon//carboncounty.csv")
carbon_data <- left_join(carbon, counties, by = "county_fips")
carbon %>%
ggplot(aes(long, lat, group = group, fill = `Total`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Mean carbon \n(tons per acre)")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Total`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Mean carbon \n(tons per acre)")
carbon_data
carbon <- read_csv("C://Users//russellm//Documents//Projects//MFRC//Carbon//carboncounty.csv")
carbon_data <- left_join(carbon, counties, by = "county_fips")
counties
carbon <- read_csv("C://Users//russellm//Documents//Projects//MFRC//Carbon//carboncounty.csv")
carbon_data <- left_join(carbon, counties, by = "county_fips")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Total`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Mean carbon \n(tons per acre)")
counties$county_fips
carbon$county_fips
carbon <- read_csv("C://Users//russellm//Documents//Projects//MFRC//Carbon//carboncounty.csv")
carbon$county_fips <- as.character(carbon$county_fips)
carbon_data <- left_join(carbon, counties, by = "county_fips")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Total`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Mean carbon \n(tons per acre)")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Total`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Total tree carbon \n(US tons)")
# Chunk 1
library(tidyverse)
library(sf)
library(spData)
library(tidycensus)
library(urbnmapr)
# Chunk 2
carbon <- read_csv("C://Users//russellm//Documents//Projects//MFRC//Carbon//carboncounty.csv")
carbon$county_fips <- as.character(carbon$county_fips)
carbon_data <- left_join(carbon, counties, by = "county_fips")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Total`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Total tree carbon \n(US tons)")
carbon <- read_csv("C://Users//russellm//Documents//Projects//MFRC//Carbon//carboncounty.csv")
carbon$county_fips <- as.character(carbon$county_fips)
carbon_data <- left_join(carbon, counties, by = "county_fips")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Total`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Total tree carbon \n(US tons)")
carbon <- read_csv("C://Users//russellm//Documents//Projects//MFRC//Carbon//carboncounty.csv")
carbon$county_fips <- as.character(carbon$county_fips)
carbon_data <- left_join(carbon, counties, by = "county_fips")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Total`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Total tree carbon \n(US tons)")
carbon <- read_csv("C://Users//russellm//Documents//Projects//MFRC//Carbon//carboncounty.csv")
carbon$county_fips <- as.character(carbon$county_fips)
carbon_data <- left_join(carbon, counties, by = "county_fips")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Total`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Total tree carbon \n(US tons)")
carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Total`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Total tree carbon \n(US tons)")+
theme_bw()
carbon_data <- left_join(carbon, counties, by = "county_fips")
p.carbon <- carbon_data %>%
ggplot(aes(long, lat, group = group, fill = `Total`)) +
geom_polygon(color = NA) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
labs(fill = "Total tree carbon \n(US tons)",
x = "",
y = "")+
theme_bw()
ggsave(filename = "C://Users//russellm//Documents//Projects//MFRC//Carbon//mn_carbon.png",
plot = p.carbon, width = 3.0, height = 3.5, units = "in")
p.carbon
blogdown:::serve_site()
p.static
p.static <- ggplot(prices, aes(rank, group = Species,
fill = as.factor(Species), color = as.factor(Species))) +
geom_tile(aes(y = Price/2,
height = Price,
width = 0.9), alpha = 0.8, color = NA) +
geom_text(aes(y = 0, label = paste(Species, " ")), vjust = 0.2, hjust = 1, size = 12) +
geom_text(aes(y = Price, label = Price_lbl, hjust = 0), size = 12) +
coord_flip(clip = "off", expand = FALSE) +
scale_y_continuous(labels = scales::comma) +
scale_x_reverse() +
guides(color = FALSE, fill = FALSE) +
theme(axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.grid.major.x = element_line(size = 0.1, color = "grey"),
panel.grid.minor.x = element_line(size = 0.1, color = "grey"),
plot.title = element_text(size = 25, hjust = 0.5, vjust = -1),
plot.subtitle = element_text(size=18, face = "italic", color = "grey",  hjust = 0.5, vjust = -1),
plot.background = element_blank(),
plot.margin = margin(2, 2, 2, 4, "cm"))
# Chunk 1
library(googlesheets4)
library(tidyverse)
library(gganimate)
library(gifski)
library(knitr)
library(formattable)
library(kableExtra)
# Chunk 4
prices <- read_sheet("https://docs.google.com/spreadsheets/d/144aoQRXLVqFO96CAdVK-AIJVZgySQr49m5i3yocHR5A/edit?usp=sharing")
p.static <- ggplot(prices, aes(rank, group = Species,
fill = as.factor(Species), color = as.factor(Species))) +
geom_tile(aes(y = Price/2,
height = Price,
width = 0.9), alpha = 0.8, color = NA) +
geom_text(aes(y = 0, label = paste(Species, " ")), vjust = 0.2, hjust = 1, size = 12) +
geom_text(aes(y = Price, label = Price_lbl, hjust = 0), size = 12) +
coord_flip(clip = "off", expand = FALSE) +
scale_y_continuous(labels = scales::comma) +
scale_x_reverse() +
guides(color = FALSE, fill = FALSE) +
theme(axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.grid.major.x = element_line(size = 0.1, color = "grey"),
panel.grid.minor.x = element_line(size = 0.1, color = "grey"),
plot.title = element_text(size = 25, hjust = 0.5, vjust = -1),
plot.subtitle = element_text(size=18, face = "italic", color = "grey",  hjust = 0.5, vjust = -1),
plot.background = element_blank(),
plot.margin = margin(2, 2, 2, 4, "cm"))
p.static
# Chunk 1
library(googlesheets4)
library(tidyverse)
library(gganimate)
library(gifski)
library(knitr)
library(formattable)
library(kableExtra)
# Chunk 4
prices <- read_sheet("https://docs.google.com/spreadsheets/d/144aoQRXLVqFO96CAdVK-AIJVZgySQr49m5i3yocHR5A/edit?usp=sharing")
# Chunk 5
prices <- prices %>%
group_by(Year) %>%
# Rank the prices by year
mutate(rank = rank(-Price),
Price_rel = Price/Price[rank==1],
Price_lbl = paste0("$ ",round(Price, 2))) %>%
group_by(Species) %>%
ungroup()
# Chunk 6
kable(prices[1:10, 1:6],
"html",
caption = 'First 10 records of the Minnesota sawtimber price dataset.') %>%
kable_styling()
# Chunk 7
p.static <- ggplot(prices, aes(rank, group = Species,
fill = as.factor(Species), color = as.factor(Species))) +
geom_tile(aes(y = Price/2,
height = Price,
width = 0.9), alpha = 0.8, color = NA) +
geom_text(aes(y = 0, label = paste(Species, " ")), vjust = 0.2, hjust = 1, size = 6) +
geom_text(aes(y = Price, label = Price_lbl, hjust = 0), size = 6) +
coord_flip(clip = "off", expand = FALSE) +
scale_y_continuous(labels = scales::comma) +
scale_x_reverse() +
guides(color = FALSE, fill = FALSE) +
theme(axis.line = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.ticks = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
legend.position = "none",
panel.background = element_blank(),
panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.grid.major.x = element_line(size = 0.1, color = "grey"),
panel.grid.minor.x = element_line(size = 0.1, color = "grey"),
plot.title = element_text(size = 25),
plot.subtitle = element_text(size=18, face = "italic", color = "grey",  hjust = 0.5, vjust = -1),
plot.background = element_blank(),
plot.margin = margin(4, 4, 4, 4, "cm"))
# Chunk 8
anim <- p.static +
transition_states(Year, transition_length = 4, state_length = 1) +
view_follow(fixed_x = TRUE)  +
labs(title = 'Minnesota sawtimber stumpage price ($/MBF): {closest_state}',
subtitle  = "Source: MN DNR Public Stumpage Price Review and Price Index, 2019")
# Chunk 9
animate(anim, 200, fps = 20,  width = 1200, height = 1000,
renderer = gifski_renderer("gganim.gif"))
